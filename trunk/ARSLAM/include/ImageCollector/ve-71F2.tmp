#include<highgui.h>


class FrameReader
{
private:
	CvCapture* inDevice_;
	IplImage** buffer_;
	int bufSize_;
	int bufPtr_;
public:
	FrameReader()
	{
		inDevice_ = NULL;
		bufSize_ = 0;
		bufPtr_ = -1;
	}
	FrameReader(CvCapture* dev, int nFrames=5)
	{
		inDevice_ = dev;
		bufSize_ = nFrames;
		bufPtr_ = -1;
		buffer_ = new IplImage*[bufSize_];
		CvSize s;
		s.width = cvGetCaptureProperty(inDevice_,CV_CAP_PROP_FRAME_WIDTH);
		s.height = cvGetCaptureProperty(inDevice_,CV_CAP_PROP_FRAME_HEIGHT);
		//allocating memory for image buffer
		for(int buf_i = 0;buf_i<bufSize_;++buf_i)
			buffer_[buf_i] = cvCreateImage(s,IPL_DEPTH_8U,3); // color images from the camera
	}

	~FrameReader()
	{
		if(bufSize_)
		{
			for(int buf_i=0;buf_i<bufSize_;++buf_i)
				cvReleaseImage(&buffer_[buf_i]);
			delete buffer_;
			buffer_ = NULL;
		}
	}
	void readFrame();
	IplImage* getLastFrame();
};